{% extends 'base.html' %}

{% block title %}Главная страница{% endblock %}

{% block content %}
    <!-- Секция героя с информацией о художнике (полноэкранная) -->
    <section class="hero-section full-viewport">
        <div class="container h-100">
            <div class="row g-0 align-items-center h-100">
                <div class="col-lg-6 order-2 order-lg-1 h-100 d-flex align-items-center">
                    <div class="artist-content">
                        <h1 class="artist-name-hero">
                            <span class="name-line">{{ artist.name }}</span>
                            <span class="artist-subtitle">Художник</span>
                        </h1>
                        <div class="bio-wrapper">
                            <p class="artist-bio-text">{{ artist.bio }}</p>
                        </div>
                        <!-- Изображение художника для мобильных устройств -->
                        <div class="d-lg-none mobile-artist-image">
                            {% if artist.photo %}
                                <div class="artist-image-wrapper">
                                    <img src="{{ artist.photo.url }}" alt="{{ artist.name }}" class="artist-hero-image">
                                </div>
                            {% else %}
                                <div class="artist-image-wrapper no-photo">
                                    <div class="image-placeholder"></div>
                                </div>
                            {% endif %}
                        </div>
                        <div class="hero-actions">
                            <a href="{% url 'painting_list' %}" class="btn btn-primary btn-hero">Смотреть работы</a>
                            <a href="{% url 'contacts' %}" class="btn btn-outline-dark btn-hero">Связаться</a>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 order-1 order-lg-2 h-100 d-flex align-items-center d-none d-lg-flex">
                    {% if artist.photo %}
                        <div class="artist-image-wrapper">
                            <img src="{{ artist.photo.url }}" alt="{{ artist.name }}" class="artist-hero-image">
                        </div>
                    {% else %}
                        <div class="artist-image-wrapper no-photo">
                            <div class="image-placeholder"></div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="scroll-indicator">
            <div class="scroll-arrow"></div>
        </div>
    </section>

    <!-- Секция избранных работ -->
    <section class="featured-section" data-aos>
        <div class="container">
            <div class="section-header text-center" data-aos>
                <h2 class="section-title">
                    <span class="title-decoration">Избранные работы</span>
                </h2>
                <p class="section-subtitle">Коллекция лучших произведений</p>
            </div>

            {% if featured_paintings.exists %}
                {% if featured_paintings.count > 3 %}
                    <!-- Данные о картинах для JavaScript (в формате JSON) -->
                    <script type="application/json" id="featured-paintings-data">
                    [
                        {% for painting in featured_paintings %}
                        {
                            "slug": "{{ painting.slug }}",
                            "title": "{{ painting.title|escapejs }}",
                            "image_url": "{{ painting.medium_image.url }}",
                            "detail_url": "{% url 'painting_detail' painting.slug %}"
                        }{% if not forloop.last %},{% endif %}
                        {% endfor %}
                    ]
                    </script>

                    <!-- Контейнер для карусели с внешними кнопками навигации -->
                    <div class="featured-carousel-container">
                        <div id="featuredCarousel" class="carousel slide" data-bs-ride="carousel">
                            <div class="carousel-inner" id="carousel-inner-container">
                                <!-- Слайды генерируются динамически через JS -->
                            </div>
                        </div>

                        <!-- Внешние кнопки навигации -->
                        <button class="carousel-nav-external prev" type="button" data-bs-target="#featuredCarousel" data-bs-slide="prev">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <path d="M12.5 15L7.5 10L12.5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        <button class="carousel-nav-external next" type="button" data-bs-target="#featuredCarousel" data-bs-slide="next">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <path d="M7.5 15L12.5 10L7.5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                {% else %}
                    <!-- Статическая сетка для 1-3 картин -->
                    <div class="featured-static-grid">
                        <div class="row g-4 justify-content-center">
                            {% for painting in featured_paintings %}
                                <div class="col-lg-4 col-md-6">
                                    <a href="{% url 'painting_detail' painting.slug %}" class="painting-card-link">
                                        <div class="painting-card featured-home-card">
                                            <div class="painting-image-wrapper">
                                                <img src="{{ painting.medium_image.url }}"
                                                     class="painting-image"
                                                     alt="{{ painting.title }}"
                                                     loading="lazy">
                                                <div class="painting-hover-overlay">
                                                    <div class="overlay-content">
                                                        <span class="view-icon">
                                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                            </svg>
                                                        </span>
                                                        <span class="view-text">Подробнее</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="painting-details featured-home-details">
                                                <h3 class="painting-name">{{ painting.title }}</h3>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
            {% else %}
                <!-- Сообщение при отсутствии избранных работ -->
                <div class="empty-state text-center">
                    <p class="empty-message">В данный момент нет избранных работ</p>
                    <a href="{% url 'painting_list' %}" class="btn btn-outline-primary mt-3">Посмотреть все работы</a>
                </div>
            {% endif %}
        </div>
    </section>

    <!-- Секция призыва к действию (CTA) -->
    <section class="cta-section" data-aos>
        <div class="container">
            <div class="cta-content text-center">
                <h3 class="cta-title">Откройте для себя мир искусства</h3>
                <p class="cta-text">Исследуйте полную коллекцию произведений в галерее</p>
                <a href="{% url 'painting_list' %}" class="btn btn-light btn-lg">Перейти в галерею</a>
            </div>
        </div>
    </section>
{% endblock %}

{% block extra_js %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Получение данных о картинах из JSON-элемента
            const paintingsDataElement = document.getElementById('featured-paintings-data');
            if (paintingsDataElement) {
                const paintings = JSON.parse(paintingsDataElement.textContent);
                const carouselInner = document.getElementById('carousel-inner-container');

                if (paintings.length > 3 && carouselInner) {
                    // Функция для определения конфигурации слайда в зависимости от ширины экрана
                    const getSlideConfig = () => {
                        const width = window.innerWidth;
                        if (width < 768) return { perSlide: 1, class: 'col-12' };
                        if (width < 992) return { perSlide: 2, class: 'col-6' };
                        return { perSlide: 3, class: 'col-lg-4' };
                    };

                    // Функция для генерации слайдов карусели
                    const generateSlides = () => {
                        // Очистка существующих слайдов
                        carouselInner.innerHTML = '';

                        const config = getSlideConfig();
                        const paintingsPerSlide = config.perSlide;
                        const colClass = config.class;

                        const totalPaintings = paintings.length;
                        const slidesNeeded = Math.ceil((totalPaintings * 3) / paintingsPerSlide);

                        // Создание циклического массива картин для бесконечной карусели
                        const cycledPaintings = [];
                        for (let i = 0; i < slidesNeeded * paintingsPerSlide; i++) {
                            cycledPaintings.push(paintings[i % totalPaintings]);
                        }

                        // Генерация слайдов
                        for (let slideIndex = 0; slideIndex < slidesNeeded; slideIndex++) {
                            const slideDiv = document.createElement('div');
                            slideDiv.className = `carousel-item ${slideIndex === 0 ? 'active' : ''}`;

                            const slideContent = document.createElement('div');
                            slideContent.className = 'carousel-slide';

                            const row = document.createElement('div');
                            row.className = 'row g-4';

                            // Добавление картин в текущий слайд
                            for (let i = 0; i < paintingsPerSlide; i++) {
                                const paintingIndex = slideIndex * paintingsPerSlide + i;
                                const painting = cycledPaintings[paintingIndex];

                                const col = document.createElement('div');
                                col.className = colClass;
                                col.innerHTML = `
                                    <a href="${painting.detail_url}" class="painting-card-link">
                                        <div class="painting-card featured-home-card">
                                            <div class="painting-image-wrapper">
                                                <img src="${painting.image_url}"
                                                     class="painting-image"
                                                     alt="${painting.title}"
                                                     loading="lazy">
                                                <div class="painting-hover-overlay">
                                                    <div class="overlay-content">
                                                        <span class="view-icon">
                                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                            </svg>
                                                        </span>
                                                        <span class="view-text">Подробнее</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="painting-details featured-home-details">
                                                <h3 class="painting-name">${painting.title}</h3>
                                            </div>
                                        </div>
                                    </a>
                                `;
                                row.appendChild(col);
                            }

                            slideContent.appendChild(row);
                            slideDiv.appendChild(slideContent);
                            carouselInner.appendChild(slideDiv);
                        }
                    };

                    // Изначальная генерация слайдов
                    generateSlides();

                    // Регенерация слайдов при ресайзе с debounce
                    let resizeTimer;
                    window.addEventListener('resize', () => {
                        clearTimeout(resizeTimer);
                        resizeTimer = setTimeout(() => {
                            generateSlides();
                            // Переинициализация карусели после регенерации
                            const carousel = bootstrap.Carousel.getInstance(document.getElementById('featuredCarousel'));
                            if (carousel) {
                                carousel.to(0);
                            }
                        }, 250);
                    });

                    // Инициализация Bootstrap Carousel
                    const carousel = new bootstrap.Carousel(document.getElementById('featuredCarousel'), {
                        interval: 4000,
                        wrap: true,
                        touch: true,
                        pause: 'hover'
                    });
                }
            }
        });
    </script>
{% endblock %}